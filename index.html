<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <canvas width='100%' height='100%' id='b'></canvas>
</body>
<style>
    body{
        overflow: hidden;
        margin: 0;
        height: 100vh;
        width: 100vw;
    }
    canvas{
        width: 100%;
        height: 100%;
    }
</style>
</html>
<script>
    'use strict';
    var requestAnimFrame = (function () {
        return window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            window.oRequestAnimationFrame ||
            window.msRequestAnimationFrame ||
            function (callback) {
                window.setTimeout(callback, 1000 / 60);
            };
    })();




    var canvas = document.getElementById("b");
    canvas.width = document.body.clientWidth
    canvas.height = document.body.clientHeight
    var context = canvas.getContext("2d");
    var map = [];
    var bots;
    function draw() {
        requestAnimFrame(draw);

        context.fillStyle = '#9f9';
        context.fillRect(0, 0, 9999, 9999);
        context.fillStyle = '#9f9';        
        if(map[0] == undefined){
            return;
        }
        for (let x in map) {
            for (let y in map[x]) {
                if (map[x][y] == 2) {
                    context.fillStyle = '#fff';
                }
                if (map[x][y] == 1) {
                   continue;
                }
                if (map[x][y] == 3) {
                    context.fillStyle = '#f99';
                }
                if (map[x][y] == 4) {
                    context.fillStyle = '#ddd';
                }
                context.fillRect(x * 5, y * 5, 5, 5);
            }
        }
        context.fillStyle = '#000';
        //requestAnimFrame(draw)
        bots.forEach(bot => {
            context.fillRect(bot[0] * 5, bot[1] * 5, 5, 5);
        });
        //requestAnimFrame(draw)
    }

    requestAnimFrame(draw)

    var socket = new WebSocket("ws://127.0.0.1:8080");
    socket.onclose = (event) => console.log('Код: ' + event.code + ' причина: ' + event.reason);
    socket.onmessage = function (event) {
        let data = JSON.parse(event.data);
        map = data[0]
        bots = data[1]
    };
    socket.onopen = () => console.log("Соединение установлено.");
    socket.onerror = (error) => console.log("Ошибка " + error.message);;

</script>